---
import Layout from "../../layouts/BaseLayout.astro";
import { getCollection } from "astro:content";

// 1) SSG 動態路由：用 nodes collection 產出所有 /node/[id]
export async function getStaticPaths() {
  const nodes = await getCollection("nodes");
  return nodes.map((entry) => ({
    params: { id: entry.data.id },
  }));
}

// 2) 從 params 取 id
const { id } = Astro.params;

// 3) 讀取 nodes collection，找到對應 id 的那篇
const nodes = await getCollection("nodes");
const entry = nodes.find((n) => n.data.id === id);

if (!entry) {
  throw new Error(`Node not found: ${id}`);
}

const node = entry.data;
---

<Layout>
  <h1>{node.title}</h1>

  <section>
    <h2>Objective</h2>
    <p>{node.objective}</p>
  </section>

  <section>
    <h2>Knowledge</h2>
    <p>{node.knowledge}</p>
  </section>

  <section>
    <h2>Practice</h2>
    <p>{node.practice}</p>
  </section>

  <section>
    <h2>DoD</h2>
    <ul>
      {node.dod.map((item) => (
        <li>{item}</li>
      ))}
    </ul>
  </section>

  <section>
    <h2>Evidence</h2>
    <p>{node.evidence}</p>
  </section>
</Layout>